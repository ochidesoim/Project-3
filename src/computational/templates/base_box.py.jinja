"""
Generated by LumenOrb v2.0
Template: base_box
Intent: {{ intent }}

Uses trimesh for geometry generation (PicoGK fallback)
"""

import sys
from pathlib import Path
import numpy as np

try:
    import trimesh
    from trimesh.creation import box
except ImportError:
    print("ERROR: trimesh not installed. Run: pip install trimesh", file=sys.stderr)
    sys.exit(1)


def main():
    """Generate base box/cube geometry"""
    
    # Parameters (injected by template engine)
    WIDTH_MM = {{ params.width_mm }}
    DEPTH_MM = {{ params.depth_mm }}
    HEIGHT_MM = {{ params.height_mm }}
    
    print(f"Creating box: width={WIDTH_MM}mm, depth={DEPTH_MM}mm, height={HEIGHT_MM}mm")
    
    try:
        # Create box mesh using trimesh
        # trimesh.box() expects extents (full dimensions), centered at origin
        mesh = box(
            extents=[WIDTH_MM, DEPTH_MM, HEIGHT_MM]
        )
        
        # Center the box (trimesh creates it centered at origin)
        # Move it so bottom is at z=0
        mesh.apply_translation([0, 0, HEIGHT_MM / 2])
        
        print(f"Generated mesh with {len(mesh.vertices)} vertices, {len(mesh.faces)} faces")
        
        # Verify mesh is watertight (manifold)
        if mesh.is_watertight:
            print("[OK] Mesh is watertight (manifold)")
        else:
            print("[WARN] Warning: Mesh is not watertight")
        
        # Output path
        output_file = Path("output.stl")
        
        print(f"Saving mesh to {output_file}...")
        mesh.export(str(output_file))
        
        print(f"SUCCESS: Box generated at {output_file}")
        
    except Exception as e:
        print(f"ERROR: {str(e)}", file=sys.stderr)
        import traceback
        traceback.print_exc()
        sys.exit(1)


if __name__ == "__main__":
    main()

