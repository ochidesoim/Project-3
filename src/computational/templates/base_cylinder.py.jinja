"""
Generated by LumenOrb v2.0
Template: base_cylinder
Intent: {{ intent }}

Uses trimesh for geometry generation (PicoGK fallback)
"""

import sys
from pathlib import Path
import numpy as np

try:
    import trimesh
    from trimesh.creation import cylinder
except ImportError:
    print("ERROR: trimesh not installed. Run: pip install trimesh", file=sys.stderr)
    sys.exit(1)


def main():
    """Generate base cylinder geometry"""
    
    # Parameters (injected by template engine)
    RADIUS_MM = {{ params.radius_mm }}
    HEIGHT_MM = {{ params.height_mm }}
    
    print(f"Creating cylinder: radius={RADIUS_MM}mm, height={HEIGHT_MM}mm")
    
    try:
        # Create cylinder mesh using trimesh
        # trimesh uses meters by default, so we keep mm as our unit
        mesh = cylinder(
            radius=RADIUS_MM,
            height=HEIGHT_MM,
            sections=64  # Smooth cylinder
        )
        
        # Center the cylinder (trimesh creates it centered at origin)
        # Move it so bottom is at z=0
        mesh.apply_translation([0, 0, HEIGHT_MM / 2])
        
        print(f"Generated mesh with {len(mesh.vertices)} vertices, {len(mesh.faces)} faces")
        
        # Verify mesh is watertight (manifold)
        if mesh.is_watertight:
            print("[OK] Mesh is watertight (manifold)")
        else:
            print("[WARN] Warning: Mesh is not watertight")
        
        # Output path
        output_file = Path("output.stl")
        
        print(f"Saving mesh to {output_file}...")
        mesh.export(str(output_file))
        
        print(f"SUCCESS: Cylinder generated at {output_file}")
        
    except Exception as e:
        print(f"ERROR: {str(e)}", file=sys.stderr)
        import traceback
        traceback.print_exc()
        sys.exit(1)


if __name__ == "__main__":
    main()
